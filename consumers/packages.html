<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Packages — CDC Monitor</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .card-hover:hover { transform: translateY(-6px); box-shadow: 0 10px 30px rgba(2,6,23,0.08); }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">

<header class="bg-white shadow-sm px-6 py-4 flex items-center justify-between">
  <div class="flex items-center gap-4">
    <h1 class="text-lg font-semibold">CDC Dashboard</h1>
    <nav class="text-sm text-slate-500">
      <a href="applicants.html" class="hover:text-indigo-600">Applicants</a>
      <a href="bookings.html" class="hover:text-indigo-600 ml-4">Bookings</a>
      <a href="packages.html" class="text-indigo-600 font-medium ml-4">Packages</a>
      <a href="shared.html" class="ml-4 hover:text-indigo-600">Shared</a>
    </nav>
  </div>
  <div class="text-sm text-slate-500">Price & capacity changes</div>
</header>

<main class="p-6" x-data="packagesApp()" x-init="init()">

  <section class="mb-6">
    <h2 class="text-lg font-semibold">Packages Overview</h2>
    <p class="text-sm text-slate-500">Capacity usage, price movements, and recent updates.</p>
  </section>

  <section class="grid grid-cols-3 gap-6">
    <template x-for="pkg in packages" :key="pkg.id">
      <div class="bg-white rounded-2xl p-4 shadow card-hover">
        <div class="flex justify-between items-start">
          <div>
            <div class="text-sm text-slate-400">Package</div>
            <div class="text-lg font-semibold" x-text="pkg.name"></div>
            <div class="text-xs text-slate-400 mt-1">ID: <span x-text="pkg.id"></span></div>
          </div>
          <div class="text-right">
            <div class="text-xs text-slate-400">Price</div>
            <div class="text-lg font-semibold" x-text="'$' + pkg.price"></div>
            <div class="text-xs text-amber-600 mt-1" x-show="pkg.isRecentlyChanged">Updated</div>
          </div>
        </div>

        <div class="mt-4 grid grid-cols-1 gap-3">
          <div>
            <div class="text-xs text-slate-400 mb-1">Capacity usage</div>
            <div class="w-full bg-slate-100 h-3 rounded-full overflow-hidden">
              <div class="h-3 bg-emerald-500" :style="'width:' + (pkg.used/pkg.capacity*100) + '%'"></div>
            </div>
            <div class="text-xs text-slate-500 mt-1" x-text="pkg.used + ' / ' + pkg.capacity + ' used'"></div>
          </div>

          <div class="flex gap-4 items-center">
            <canvas :id="'spark-'+pkg.id" width="120" height="40"></canvas>
            <div class="text-xs text-slate-500">
              <div>Recent price changes</div>
              <div class="font-medium" x-text="pkg.priceChangeLabel"></div>
            </div>
          </div>
        </div>

        <div class="mt-4 border-t pt-3 text-sm text-slate-600">
          <button class="text-xs px-3 py-1 rounded bg-slate-100" @click="viewHistory(pkg)">View history</button>
        </div>
      </div>
    </template>
  </section>

  <section class="mt-6 bg-white p-4 rounded-2xl shadow" x-show="activePkg" x-transition>
    <div class="flex justify-between">
      <div>
        <h3 class="font-semibold">Change History — <span x-text="activePkg.name"></span></h3>
        <div class="text-xs text-slate-400" x-text="'ID: ' + activePkg.id"></div>
      </div>
      <div><button class="text-xs px-3 py-1 rounded bg-slate-100" @click="activePkg=null">Close</button></div>
    </div>

    <div class="mt-3 grid grid-cols-3 gap-4">
      <div>
        <h4 class="text-xs text-slate-400">Price History</h4>
        <ul class="mt-2 text-sm space-y-2">
          <template x-for="h in activePkg.history" :key="h.ts">
            <li class="p-2 rounded-lg" :class="h.type==='Price' ? 'bg-slate-50' : 'bg-slate-100'">
              <div class="flex justify-between">
                <div><b x-text="h.label"></b></div>
                <div class="text-xs text-slate-400" x-text="new Date(h.ts).toLocaleString()"></div>
              </div>
              <div class="text-xs text-slate-500 mt-1" x-text="h.details"></div>
            </li>
          </template>
        </ul>
      </div>

      <div>
        <h4 class="text-xs text-slate-400">Capacity changes</h4>
        <ul class="mt-2 text-sm space-y-2">
          <template x-for="h in activePkg.history" :key="h.ts+'c'">
            <template x-if="h.type==='Capacity'">
              <li class="p-2 rounded-lg bg-slate-50">
                <div class="flex justify-between">
                  <div x-text="h.label"></div>
                  <div class="text-xs text-slate-400" x-text="h.delta"></div>
                </div>
                <div class="text-xs text-slate-500 mt-1" x-text="new Date(h.ts).toLocaleString()"></div>
              </li>
            </template>
          </template>
        </ul>
      </div>

      <div>
        <h4 class="text-xs text-slate-400">Recent impact</h4>
        <div class="mt-2 text-sm text-slate-600">
          <div x-text="activePkg.summary"></div>
        </div>
      </div>
    </div>
  </section>

</main>

<script>
function packagesApp(){
  return {
    packages: [],
    activePkg: null,

    init(){
      // seed
      this.packages = [
        { id:12, name:'Family Pack', price:120, capacity:10, used:7, isRecentlyChanged:true, priceHistory:[115,118,120], history:[
            { type:'Price', ts: Date.now()-1000*60*60*24*3, label:'Price → 118', details:'Previous 115 → 118' },
            { type:'Price', ts: Date.now()-1000*60*60*24*1, label:'Price → 120', details:'Updated from 118 to 120' },
            { type:'Capacity', ts: Date.now()-1000*60*60*24*5, label:'Capacity ↑', delta:'+2' }
          ],
          summary:'In last 7 days 8 bookings affected capacity (7/10 used).'
        },
        { id:15, name:'Solo Package', price:45, capacity:50, used:20, isRecentlyChanged:false, priceHistory:[40,42,45], history:[
            { type:'Price', ts: Date.now()-1000*60*60*24*10, label:'Price → 42', details:'Promotional change' },
            { type:'Price', ts: Date.now()-1000*60*60*24*2, label:'Price → 45', details:'Regularized price' }
          ], summary:'Steady bookings, capacity at 40%.' },
        { id:21, name:'Couple Pack', price:80, capacity:20, used:12, isRecentlyChanged:false, priceHistory:[75,80,80], history:[
            { type:'Price', ts: Date.now()-1000*60*60*24*7, label:'Price → 80', details:'Seasonal increase' }
          ], summary:'Capacity moving towards limit.' }
      ];

      // draw sparklines
      setTimeout(()=> this.renderSparklines(), 300);
    },

    viewHistory(pkg){
      this.activePkg = pkg;
    },

    renderSparklines(){
      this.packages.forEach(p=>{
        const ctx = document.getElementById('spark-'+p.id).getContext('2d');
        new Chart(ctx, { type:'line', data:{ labels: p.priceHistory.map((_,i)=>i), datasets:[{ data: p.priceHistory, fill:false, borderColor:'#F97316', tension:0.4, pointRadius:0 }]}, options:{ plugins:{legend:{display:false}}, scales:{x:{display:false}, y:{display:false}} , maintainAspectRatio:false, responsive:false }});
      });
    }
  };
}
</script>

</body>
</html>
